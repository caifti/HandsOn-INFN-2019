



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.5.0">
    
    
      
        <title>Hands on FaaS triggers - HandsOn-INFN-2019</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#working-with-functions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="HandsOn-INFN-2019" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud_circle</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              HandsOn-INFN-2019
            </span>
            <span class="md-header-nav__topic">
              
                Hands on FaaS triggers
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/DODAS-TS/HandsOn-INFN-2019/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="HandsOn-INFN-2019" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud_circle</i>
      
    </a>
    HandsOn-INFN-2019
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/DODAS-TS/HandsOn-INFN-2019/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Kubernetes mini tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Kubernetes mini tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../k8s/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../k8s/pods/" title="Pods" class="md-nav__link">
      Pods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../k8s/debugging/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../k8s/services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../htcondor/cvmfs/" title="CVMFS" class="md-nav__link">
      CVMFS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      HTCondor on demand
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        HTCondor on demand
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../htcondor/deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../htcondor/templating/" title="Templating" class="md-nav__link">
      Templating
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      FaaS hands-on
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        FaaS hands-on
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../faas/" title="Setup FaaS framework" class="md-nav__link">
      Setup FaaS framework
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Hands on FaaS triggers
      </label>
    
    <a href="./" title="Hands on FaaS triggers" class="md-nav__link md-nav__link--active">
      Hands on FaaS triggers
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vagrant-installation-windows" class="md-nav__link">
    Vagrant installation - Windows
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vagrant-installation-linux" class="md-nav__link">
    Vagrant installation - Linux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vagrant-installation-macos" class="md-nav__link">
    Vagrant installation - MacOS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-vagrant-project" class="md-nav__link">
    Install Vagrant project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-example-functions-and-the-openfaas-ui" class="md-nav__link">
    Using example functions and the OpenFaaS UI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-of-a-python-function-from-openfaas-workshop" class="md-nav__link">
    Deployment of a Python function (from OpenFaaS workshop)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-fundamentals" class="md-nav__link">
    Function fundamentals
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-the-functions-code" class="md-nav__link">
    Write the function's code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-function" class="md-nav__link">
    Deploy the function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#homework" class="md-nav__link">
    Homework
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../workflows/" title="Managing storage events and FaaS" class="md-nav__link">
      Managing storage events and FaaS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Extras
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Extras
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../k3s/" title="k3s - Deploy kubernetes cluster in 1 min for development" class="md-nav__link">
      k3s - Deploy kubernetes cluster in 1 min for development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extras/ansible/" title="Ansible deployment of a webserver" class="md-nav__link">
      Ansible deployment of a webserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extras/orchent/" title="PaaS Orchestrator" class="md-nav__link">
      PaaS Orchestrator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vagrant-installation-windows" class="md-nav__link">
    Vagrant installation - Windows
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vagrant-installation-linux" class="md-nav__link">
    Vagrant installation - Linux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vagrant-installation-macos" class="md-nav__link">
    Vagrant installation - MacOS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-vagrant-project" class="md-nav__link">
    Install Vagrant project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-example-functions-and-the-openfaas-ui" class="md-nav__link">
    Using example functions and the OpenFaaS UI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-of-a-python-function-from-openfaas-workshop" class="md-nav__link">
    Deployment of a Python function (from OpenFaaS workshop)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-fundamentals" class="md-nav__link">
    Function fundamentals
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-the-functions-code" class="md-nav__link">
    Write the function's code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-function" class="md-nav__link">
    Deploy the function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#homework" class="md-nav__link">
    Homework
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/DODAS-TS/HandsOn-INFN-2019/edit/master/docs/faas/events.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="working-with-functions">Working with functions</h1>
<p>You can get a local environment ready using Vagrant for an automatically setting up a machine on Virtualbox.
To download Vagrant follow this link where you can find the complete list based on Os System:</p>
<ul>
<li><a href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a></li>
</ul>
<h2 id="vagrant-installation-windows">Vagrant installation - Windows</h2>
<p>Download the following file and install it:</p>
<ul>
<li><a href="https://releases.hashicorp.com/vagrant/2.2.5/vagrant_2.2.5_x86_64.msi">https://releases.hashicorp.com/vagrant/2.2.5/vagrant_2.2.5_x86_64.msi</a></li>
</ul>
<h2 id="vagrant-installation-linux">Vagrant installation - Linux</h2>
<p>Download the package and extract it just pasting the following commands:</p>
<div class="codehilite"><pre><span></span>wget https://releases.hashicorp.com/vagrant/2.2.5/vagrant_2.2.5_linux_amd64.zip
unzip vagrant_2.2.5_linux_amd64.zip
</pre></div>


<p>You can also use <a href="https://docs.brew.sh/Homebrew-on-Linux">Homebrew</a> like this:</p>
<div class="codehilite"><pre><span></span>brew cask install vagrant
</pre></div>


<p>If you prefer, you can use your favorite package manager. For example, in Ubuntu
you can type:</p>
<div class="codehilite"><pre><span></span>sudo apt install virtualbox vagrant
</pre></div>


<h2 id="vagrant-installation-macos">Vagrant installation - MacOS</h2>
<p>Download the dmg file and install it:</p>
<ul>
<li><a href="https://releases.hashicorp.com/vagrant/2.2.5/vagrant_2.2.5_x86_64.dmg">https://releases.hashicorp.com/vagrant/2.2.5/vagrant_2.2.5_x86_64.dmg</a></li>
</ul>
<p>If you have <a href="https://brew.sh/">Homebrew</a> installed just type this in the command line:</p>
<div class="codehilite"><pre><span></span>brew cask install vagrant
</pre></div>


<h2 id="install-vagrant-project">Install Vagrant project</h2>
<p>To be operative with the current project you have to download with <a href="https://git-scm.com/downloads">git</a> or
extract the <a href="https://github.com/Cloud-PG/SOSC2019/archive/master.zip">zip file</a>.</p>
<p>Open your command line and paste the following commands:</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/Cloud-PG/SOSC2019.git
<span class="nb">cd</span> SOSC2019
</pre></div>


<p>Now set up the vagrant environment using the following command:</p>
<div class="codehilite"><pre><span></span>./vagrant up
<span class="c1"># Or if you have vagrant executable in your PATH</span>
vagrant up
</pre></div>


<blockquote>
<p><strong>NOTE</strong>: This may take few minutes, depending on network and your computer performance</p>
</blockquote>
<p>And then, log into the created machine:</p>
<div class="codehilite"><pre><span></span>./vagrant ssh
<span class="c1"># Or if you have vagrant executable in your PATH</span>
vagrant ssh
</pre></div>


<p>Remember also to authenticate with OpenFaaS cli before continuing:</p>
<div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">OPENFAAS_URL</span><span class="o">=</span>http://127.0.0.1:31112
cat gateway-password.txt <span class="p">|</span> faas-cli login --password-stdin
</pre></div>


<blockquote>
<p><strong>NOTE</strong>: Vagrant and Virtualbox are required on the machine of course. If you don't have them
check the previous steps to install the packages</p>
</blockquote>
<p>Some additional machines have been prepared for the school participants. You can find hot to access to your machine <a href="https://raw.githubusercontent.com/Cloud-PG/SOSC2019/master/ansible/hosts">here</a></p>
<h2 id="using-example-functions-and-the-openfaas-ui">Using example functions and the OpenFaaS UI</h2>
<p>Now you can go to <a href="http://localhost:31112/ui/" target="_blank">http://localhost:31112/ui/</a> and, using the password in gateway_password.txt with user <code>admin</code>, you should be able to log in. To see your password just type:</p>
<div class="codehilite"><pre><span></span>cat gateway-password.txt
</pre></div>


<p>You will have a page like that as result after the login:</p>
<p><img alt="OpenFaaS UI" src="../img/openfaasstartup.png" title="OpenFaaS UI" /></p>
<p>Let's start playing with some example functions. For instance, you can instantiate a function the face-detection of an online image just clicking on <code>Deploy new function</code>, searching for <code>opencv</code> and installing <code>face-detect with OpenCV</code> (button <code>Deploy</code>).</p>
<p><img alt="New function" src="../img/openfaasstartup_new_function.png" /></p>
<hr />
<p><img alt="Face detect function" src="../img/openfaasstartup_install_dace_detect.png" /></p>
<p>Now a new tab should appear with the function name selected. </p>
<p><img alt="Function dashboard" src="../img/openfaasstartup_function.png" /></p>
<p>From there you can check the status and also try to invoke the function from the UI.
For instance, as soon as the status of the function is ready, let's try to put an url with a jpg image in the request body field and then press invoke.</p>
<p>Let's try the two below for example:</p>
<div class="codehilite"><pre><span></span>https://parismatch.be/app/uploads/2018/04/Macaca_nigra_self-portrait_large-e1524567086123-1100x715.jpg
http://thedreamwithinpictures.com/wp-content/uploads/2013/05/c3a89__montage_2048-copy.jpg
</pre></div>


<p>For the second one you will have the following result:</p>
<p><img alt="New function" src="../img/openfaasstartup_example.png" /></p>
<hr />
<p><img alt="New function" src="../img/openfaasstartup_example_result.jpg" /></p>
<p>The list of all available functions in the store is also available from CLI using the following command from the vagrant machine already created:</p>
<div class="codehilite"><pre><span></span>faas-cli store list
</pre></div>


<h2 id="deployment-of-a-python-function-from-openfaas-workshop">Deployment of a Python function (from <a href="https://github.com/openfaas/workshop/blob/master/lab3.md#example-function-astronaut-finder">OpenFaaS workshop</a>)</h2>
<p>Do everyone have a docker account?</p>
<div class="codehilite"><pre><span></span>mkdir astronaut-finder
<span class="nb">cd</span> astronaut-finder

faas-cli new --lang python3 astronaut-finder --prefix<span class="o">=</span><span class="s2">&quot;&lt;your-docker-username-here&gt;&quot;</span>
</pre></div>


<h3 id="function-fundamentals">Function fundamentals</h3>
<p>The previous command will write three files for us:</p>
<p><code>./astronaut-finder/handler.py</code></p>
<p>This is the handler for the function. </p>
<blockquote>
<p><strong>NOTE</strong>: an handler get a request object with the raw request and can print the result of the function to the console.</p>
</blockquote>
<p><code>./astronaut-finder/requirements.txt</code></p>
<p>Use this file to list any pip modules you want to install so, to manage your Python requirements, such as requests or urllib</p>
<p><code>./astronaut-finder.yml</code>
This file is used to manage the function:</p>
<blockquote>
<p><strong>NOTE</strong>: it has the name of the function, the Docker image and any other customizations needed.</p>
</blockquote>
<p>Edit <code>./astronaut-finder/requirements.txt</code> and add the following dependency:</p>
<div class="codehilite"><pre><span></span><span class="err">requests</span>
</pre></div>


<h3 id="write-the-functions-code">Write the function's code</h3>
<p>We'll be pulling in data from <a href="http://api.open-notify.org/astros.json">http://api.open-notify.org/astros.json</a></p>
<p>Here's an example of the result we will have from that url:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
  <span class="nt">&quot;people&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;craft&quot;</span><span class="p">:</span> <span class="s2">&quot;ISS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alexander Misurkin&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;craft&quot;</span><span class="p">:</span> <span class="s2">&quot;ISS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Mark Vande Hei&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;craft&quot;</span><span class="p">:</span> <span class="s2">&quot;ISS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Joe Acaba&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;craft&quot;</span><span class="p">:</span> <span class="s2">&quot;ISS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Anton Shkaplerov&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;craft&quot;</span><span class="p">:</span> <span class="s2">&quot;ISS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Scott Tingle&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;craft&quot;</span><span class="p">:</span> <span class="s2">&quot;ISS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Norishige Kanai&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Let's write an handler that gets for us that result. You have to edit <code>handler.py</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">req</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://api.open-notify.org/astros.json&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;people&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is in space&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>


<h3 id="deploy-the-function">Deploy the function</h3>
<p>First, build it:</p>
<div class="codehilite"><pre><span></span>faas-cli build -f ./astronaut-finder.yml
</pre></div>


<p>Push the function:</p>
<div class="codehilite"><pre><span></span>docker login
faas-cli push -f ./astronaut-finder.yml
</pre></div>


<p>Deploy the function:</p>
<div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">OPENFAAS_URL</span><span class="o">=</span>http://127.0.0.1:31112
cat  <span class="nv">$HOME</span>/gateway-password.txt <span class="p">|</span> faas-cli login --password-stdin
faas-cli deploy -f ./astronaut-finder.yml
</pre></div>


<p>And now, just wait a bit for the function to be in <code>Ready</code> state. Check from cli with
the following command:</p>
<div class="codehilite"><pre><span></span>faas-cli describe astronaut-finder <span class="p">|</span> grep Status
</pre></div>


<p>You will have a result like this if everythings is up and running:</p>
<div class="codehilite"><pre><span></span>Status:              Ready
</pre></div>


<p>and then try to invoke it from command line:</p>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="p">|</span> faas-cli invoke astronaut-finder
</pre></div>


<p>You will receive this as response a random name of a docker user, like this:</p>
<div class="codehilite"><pre><span></span>Anton Shkaplerov is in space
</pre></div>


<p>You can also use the http endpoint:</p>
<div class="codehilite"><pre><span></span>curl http://localhost:31112/function/astronaut-finder
</pre></div>


<p>Or try it from the dashboard, just clicking to <code>invoke</code> and see the result in <code>response body</code>:</p>
<p><img alt="Astronaut dashboard" src="../img/openfaas_astronauts.png" /></p>
<h2 id="homework">Homework</h2>
<ol>
<li>Try to create a function for serving your ML model (you can also make use of: <a href="https://github.com/alexellis/tensorflow-serving-openfaas">https://github.com/alexellis/tensorflow-serving-openfaas</a> )</li>
<li>Create a function in a different language if you know any</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../faas/" title="Setup FaaS framework" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setup FaaS framework
              </span>
            </div>
          </a>
        
        
          <a href="../workflows/" title="Managing storage events and FaaS" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Managing storage events and FaaS
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a8b5e56f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>